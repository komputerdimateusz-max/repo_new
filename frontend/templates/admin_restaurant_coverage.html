{% extends "base.html" %}

{% block title %}Restaurant Coverage · repo_new{% endblock %}

{% block content %}
<div class="page-container">
  <header class="page-header">
    <div>
      <h1 class="page-title">Restaurant delivery coverage</h1>
      <p class="page-subtitle">Manage active delivery mappings and cut-off overrides.</p>
    </div>
    <span class="pill pill--accent">{% if current_user.role == 'restaurant' %}Restaurant{% else %}Administrator{% endif %}</span>
  </header>

  {% if current_user.role == "admin" %}
  <section class="section">
    <h2 class="section-title">Restaurant</h2>
    <div class="form-card">
      <form method="get" action="{{ '/restaurant/coverage' if current_user.role == 'restaurant' else '/admin/restaurant-coverage' }}" class="stack-md">
        <label class="field"><span>Restaurant</span>
          <select class="input" name="restaurant_id" onchange="this.form.submit()">
            {% for restaurant in restaurants %}
            <option value="{{ restaurant.id }}" {% if selected_restaurant_id == restaurant.id %}selected{% endif %}>{{ restaurant.name }}</option>
            {% endfor %}
          </select>
        </label>
      </form>
    </div>
  </section>
  {% endif %}

  <section class="section">
    <h2 class="section-title">Locations</h2>
    <div class="stack-md">
      {% for location in locations %}
      {% set mapping = mapping_by_location.get(location.id) %}
      <div class="form-card">
        <form method="post" action="{{ '/restaurant/coverage' if current_user.role == 'restaurant' else '/admin/restaurant-coverage' }}" class="stack-md">
          {% if current_user.role == "admin" %}<input type="hidden" name="restaurant_id" value="{{ selected_restaurant_id }}" />{% endif %}
          <input type="hidden" name="location_id" value="{{ location.id }}" />
          <strong class="text-wrap">{{ location.company_name }} — {{ location.address }}</strong>
          <label class="field-inline"><input type="checkbox" name="is_active" {% if mapping and mapping.is_active %}checked{% endif %}/> Active mapping</label>
          <label class="field"><span>Cutoff override</span><input class="input" type="time" name="cut_off_time_override" value="{{ mapping.cut_off_time_override.strftime('%H:%M') if mapping and mapping.cut_off_time_override else '' }}" /></label>
          <button type="submit" class="btn btn--secondary">Save</button>
        </form>
      </div>
      {% endfor %}
    </div>
  </section>
</div>
{% endblock %}
