{% extends "base.html" %}

{% block title %}repo_new | {{ t('menu.title', lang) }}{% endblock %}

{% block content %}
<div class="page-container">
  <header class="page-header">
    <div>
      <h1 class="page-title">{{ t('menu.title', lang) }}{% if current_restaurant %} - {{ current_restaurant.name }}{% endif %}</h1>
      <p class="page-subtitle">{{ t('menu.subtitle', lang) }}</p>
    </div>
    <span class="pill pill--accent">Restaurant</span>
  </header>

  {% if message %}
  <p class="alert alert-success" role="status">{{ message }}</p>
  {% endif %}
  {% if error %}
  <p class="alert alert-error" role="alert">{{ error }}</p>
  {% endif %}

  <section class="section">
    <h2 class="section-title">{{ t('menu.add_item', lang) }}</h2>
    <div class="form-card">
      <form method="post" action="/catering/menu" class="stack-md">
        <label class="field">
          <span>{{ t('menu.name', lang) }}</span>
          <input class="input" type="text" name="name" required />
        </label>
        <label class="field">
          <span>{{ t('menu.description', lang) }}</span>
          <input class="input" type="text" name="description" />
        </label>
        <label class="field">
          <span>{{ t('menu.price', lang) }}</span>
          <input class="input" type="number" step="0.01" min="0.01" name="price" placeholder="12.50" required />
        </label>
        <label class="checkbox-field">
          <input type="checkbox" name="is_active" checked />
          <span>{{ t('menu.active', lang) }}</span>
        </label>
        <label class="checkbox-field">
          <input type="checkbox" name="is_standard" />
          <span>{{ t('menu.standard', lang) }}</span>
        </label>
        <button type="submit" class="btn btn--primary">{{ t('menu.add_button', lang) }}</button>
      </form>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">{{ t('menu.catalog_items', lang) }}</h2>
    <div class="form-card">
      {% if catalog_items %}
      <ul class="menu-list">
        {% for item in catalog_items %}
        <li class="menu-list-item">
          <div class="stack-md">
            <div>
              <strong>{{ item.name }}</strong>
              {% if item.description %}<p>{{ item.description }}</p>{% endif %}
              <p>{{ '%.2f'|format(item.price_cents / 100) }} PLN</p>
            </div>
            <div class="menu-actions">
              <span class="badge {% if item.is_active %}badge-active{% else %}badge-inactive{% endif %}">{% if item.is_active %}{{ t('menu.status_active', lang) }}{% else %}{{ t('menu.status_inactive', lang) }}{% endif %}</span>
              {% if item.is_standard %}
              <span class="badge badge-active">{{ t('menu.standard_always_visible', lang) }}</span>
              <form method="post" action="/catering/menu/{{ item.id }}/toggle">
                <button type="submit" class="btn btn--secondary btn-inline">{% if item.is_active %}{{ t('menu.disable', lang) }}{% else %}{{ t('menu.enable', lang) }}{% endif %}</button>
              </form>
              {% else %}
              <span class="badge {% if item.id in enabled_today_ids %}badge-active{% else %}badge-inactive{% endif %}">{% if item.id in enabled_today_ids %}{{ t('menu.enabled_today', lang) }}{% else %}{{ t('menu.not_enabled_today', lang) }}{% endif %}</span>
              <form method="post" action="/catering/menu/{{ item.id }}/toggle">
                <button type="submit" class="btn btn--secondary btn-inline">{% if item.id in enabled_today_ids %}{{ t('menu.disable_today', lang) }}{% else %}{{ t('menu.enable_today', lang) }}{% endif %}</button>
              </form>
              {% endif %}
            </div>
          </div>
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <p>{{ t('menu.empty', lang) }}</p>
      {% endif %}
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">{{ t('menu.items_for_day', lang) }}</h2>
    <div class="form-card">
      {% if standard_items %}
      <h3 class="section-subtitle">{{ t('menu.standard_section', lang) }}</h3>
      <ul class="menu-list">
        {% for item in standard_items %}
        <li class="menu-list-item">
          <strong>{{ item.name }}</strong>
          {% if item.description %}<p>{{ item.description }}</p>{% endif %}
          <p>{{ '%.2f'|format(item.price_cents / 100) }} PLN</p>
          <span class="badge badge-active">{{ t('menu.standard_always_visible', lang) }}</span>
        </li>
        {% endfor %}
      </ul>
      {% endif %}

      {% if daily_additional_items %}
      <h3 class="section-subtitle">{{ t('menu.daily_extra_section', lang) }}</h3>
      <ul class="menu-list">
        {% for daily in daily_additional_items %}
        <li class="menu-list-item">
          <strong>{{ daily.catalog_item.name }}</strong>
          {% if daily.catalog_item.description %}<p>{{ daily.catalog_item.description }}</p>{% endif %}
          <p>{{ '%.2f'|format(daily.catalog_item.price_cents / 100) }} PLN</p>
          <form method="post" action="/catering/menu/{{ daily.catalog_item_id }}/toggle">
            <button type="submit" class="btn btn--secondary btn-inline">{{ t('menu.disable_today', lang) }}</button>
          </form>
        </li>
        {% endfor %}
      </ul>
      {% endif %}

      {% if not standard_items and not daily_additional_items %}
      <p>{{ t('menu.empty', lang) }}</p>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
