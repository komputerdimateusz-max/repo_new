<!doctype html><html><body>
<h1>Profile</h1>
<p data-email>{{ email }}</p>
<a href="/">Back to order</a>
<form id="profile-form">
  <input name="name" placeholder="name" required />
  <input name="postal_code" placeholder="postal code" />
  <select name="company_id" id="company_id"></select>
  <button type="submit">Save</button>
</form>
<p id="msg"></p>
<script>
async function init(){
 const me=await fetch('/api/v1/me').then(r=>r.json());
 const companies=await fetch('/api/v1/companies').then(r=>r.json());
 const sel=document.getElementById('company_id');
 sel.innerHTML=companies.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
 document.querySelector('[name=name]').value=me.name;
 document.querySelector('[name=postal_code]').value=me.postal_code||'';
 sel.value=String(me.company_id);
}
 document.getElementById('profile-form').addEventListener('submit',async(e)=>{
 e.preventDefault();
 const payload={name:document.querySelector('[name=name]').value,postal_code:document.querySelector('[name=postal_code]').value||null,company_id:Number(document.getElementById('company_id').value)};
 await fetch('/api/v1/me',{method:'PATCH',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
 document.getElementById('msg').textContent='Saved';
 });
 init();
</script>
</body></html>
